<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13.1 (455786)"/><meta name="author" content="Austin R English"/><meta name="created" content="2015-11-23 21:51:00 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-12-19 02:58:00 +0000"/><title>35_dsPIC &amp; Motor Driver Prototyping</title></head><body>
<div>A dsPIC30 left over from a previous project was used to create some prototypes for the electrical system and processing unit.</div>
<div>Over Thanksgiving break, the dsPIC30 shown in Figure 1 was successfully programmed with the code shown in Figure 2 to produce a fabricated PWM signal on one of its GPIO pins.  This PWM signal was used to turn on and off an LED, representing possible indicator LED’s for the device.</div>
<div><br/></div>
<div><br/></div>
<div><img src="35_dsPIC%20&amp;%20Motor%20Driver%20Prototyping.resources/PIC%20LED.jpg" height="720" width="960"/></div>
<div>Figure 1:  sPIC30 Lighting Up An Attached LED</div>
<div><br/></div>
<div><img src="35_dsPIC%20&amp;%20Motor%20Driver%20Prototyping.resources/Final%20Code.png" height="339" width="309"/></div>
<div>Figure 2:  dsPIC30 GPIO Initialization C Code</div>
<div><br/></div>
<div><br/></div>
<div>The PWM signal was created by simply adding a delay between turning on and off the output pin.  This would not suffice for the final program design as the program delays block other code from executing.  Either the dsPIC’s actual PWM systems would need to used, or timers could be used as well to provide better PWM signals.  For now though, this PWM signal has been used in the motor driver circuit shown below in Figure 3.  The PWM signal was used to run our test motor at various speeds by modifying the delay time periods in the dsPIC program.</div>
<div><br/></div>
<div><img src="35_dsPIC%20&amp;%20Motor%20Driver%20Prototyping.resources/Motor%20Driver%20Mockup.jpg" height="1536" width="2048"/></div>
<div>Figure 3:  Motor Driver Prototype Circuit</div>
<div><br/></div>
<div><br/></div>
<div>The graph below (Fig. 4) was obtained by measuring the voltage over a shunt resistor in series with the test motor as the motor was subjected to an increasing load at its shaft, provided by a spring of known spring constant.  The point at which the motor was pulling a load of about alb was calculated to be at 23.5 seconds on the graph, corresponding to about 48mA.  When plugging 48mA into our ideal equation (Eq 1) for the motor’s torque-current relationship (created from ideal specifications for the motor), the motor load supplied at the surface of the shaft is about 1.05lb.  It seems like the motor operates reliably close to its predicted trends.</div>
<div><br/></div>
<div><img src="35_dsPIC%20&amp;%20Motor%20Driver%20Prototyping.resources/Screen%20Shot%202015-12-09%20at%208.23.00%20PM.png" height="88" width="1054"/>Equation 1</div>
<div><br/></div>
<div><img src="35_dsPIC%20&amp;%20Motor%20Driver%20Prototyping.resources/Motor%20Current%20Data.png" height="2550" width="3300"/></div>
<div>    Figure 4:  Graph of Motor Current Data </div>
<div><br/></div>
<div>Finally, a pseudo program covering the overall operation of the device was created so get a better idea of how the device’s program will be structured (Fig. 5).  The main loop will constantly be reading in data from the motor position and load feedback as well as values from the EMG system.  When threshold values are hit, corresponding interrupts will determine whether those values are significant enough to act on or not.  Also in the interrupts are User I/O monitors which will simply be triggered when one of the User I/O switches changes state.  More detailed pseudo-code for the interrupts was worked out as in Figure 6.</div>
<div><br/></div>
<div><img src="35_dsPIC%20&amp;%20Motor%20Driver%20Prototyping.resources/Program%20Model%20p1.png" height="2238" width="2916"/></div>
<div>Figure 5:  Program Structure</div>
<div><br/></div>
<div><br/></div>
<div><img src="35_dsPIC%20&amp;%20Motor%20Driver%20Prototyping.resources/Program%20Model%20p2.png" height="3197" width="3491"/></div>
<div>Figure 6:  Pseudo Program of Interrupt Service Routines</div>
<div><br/></div>
<div><br/></div>
</body></html>