<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13.1 (455786)"/><meta name="author" content="Austin R English"/><meta name="created" content="2016-01-19 21:32:00 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-12-19 02:58:25 +0000"/><title>42_Automating Encoder Signal Detection</title></head><body>
<div>Because the MCU will not be able to constantly check every encoder’s input constantly while performing other calculations, a sort of interrupt would need to be used to monitor the encoder pulses.  Whenever the pulse signal changes, an interrupt can be set off, and the interrupt handler function can modify an integer keeping track of how many pulses have been received.  If the motor is traveling clockwise, each pulse could be added to the integer; if the motor is traveling counter-clockwise, each pulse could be subtracted from the integer or vice versa.  This integer can be converted into the motor’s rotational position, knowing how many pulses it takes to rotate the output shaft.</div>
<div><br/></div>
<div>To automatically detect when the encoder pulse signals changed, the MCU’s change notification system was used.  Only certain pins can accommodate change notification interrupts, so the circuit schematic may need to be modified to ensure that the GPIO pins for the encoders have change notification (CN).  <b>Figure 1</b> shows the two functions used to setup the CN system.  The <b>encoder_init( )</b> function enables the CN functionality on the input pin, enables the interrupt, and resets the interrupt flag.  The <b>_CNInterrupt( )</b> function is called whenever the pin’s interrupt flag is set.  This function increases an integer variable to keep track of how many pulses are received, changes the status of the indicator LED, and resets the interrupt flag.</div>
<div><img src="42_Automating%20Encoder%20Signal%20Detection.resources/Screen%20Shot%202016-01-20%20at%208.44.43%20PM.png" height="700" width="1324"/></div>
<div><i><b>Figure 1:  Initialization and Interrupt Handler Functions For Change Notification Pin</b></i></div>
<div><i><b><br/></b></i></div>
<div>The MCU’s CN functionality allowed the program’s main loop to remain empty while encoder pulses were handled in the background.  The problem of the MCU resetting every 10 seconds or so was still happening.  Reading about possible causes for this, I tried disabling the Watchdog Timer in the programs configuration bits.  This seemed to work as the program did not restart on its own anymore after that.  The Watchdog Timer (WTD) is supposed to reset the device if a processing malfunction is detected; so in the previous test after the count integer had reached the max value and had the motor duty cycle set to 0%, the WTD was probably detecting that the main loop was repeating without accomplishing anything (once the max. integer value was reached, all the main loop was doing was checking to see if the integer was less than that value).</div>
</body></html>