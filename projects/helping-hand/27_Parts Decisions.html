<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13.1 (455786)"/><meta name="author" content="Austin R English"/><meta name="created" content="2015-11-02 01:48:21 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-12-19 02:57:34 +0000"/><title>27_Parts Decisions</title></head><body>
<div>For the Electrical and EMG systems, several components still had to be chosen in order to move forward with prototyping and evaluation of our proposed system circuits.  The parts were:</div>
<div><b>1.  External 16-bit ADC</b></div>
<div><b>2.  Motor Drivers (H-bridges)</b></div>
<div><b>3.  Voltage Regulators</b></div>
<div><b>4.  Micro-Controller</b></div>
<div><b>5. </b> <b>Batteries &amp; charger</b></div>
<div><b><br/></b></div>
<div><b><br/></b></div>
<div><b><br/></b></div>
<div><b>1.</b>  Chris and I decided to use an external ADC for the device.  We were able to find micro-controllers that had 16-bit 4channel ADC’s, but compatible evaluation boards for the chips were not providing access to all the channels.  Additionally, having the ADC conversions being performed in a separate unit would leave less work for the uController to do.</div>
<div><br/></div>
<div>     We needed an ADC with at least 4ch (may need 5, but are only expecting 3-4 for now) to measure the desired signal spots on the user’s arm.  The ADC also needed to communicate through something like SPI or I2C (preferably SPI for speed).  After looking through several TI and Analog Devices ADC’s, I found a TI ADC that would suit the EMG system requirements and communicate well with the uController.</div>
<div><br/></div>
<div>     The TI <b>ADS1120</b> (Fig. 1) is a 16-bit 4ch. ADC that has several integrated features in addition to simple A-D-C.  It has a programmable gain feature which may help us reduce the number of op-amps needed. It also can perform basic digital filtering on the received signals if the sampling rate is low enough.  It can also sample at a max. of 2kHz, which is more than the 1kHz maximum we expected the EMG system to ever need.   Data sheet: <a href="http://www.ti.com/lit/ds/symlink/ads1120.pdf">http://www.ti.com/lit/ds/symlink/ads1120.pdf</a></div>
<div><br/></div>
<div>                                </div>
<div><img src="27_Parts%20Decisions.resources/Screen%20Shot%202015-11-01%20at%208.31.17%20PM.png" height="750" width="1420"/></div>
<div><b>Figure 1:  </b><b>ADS1120 Analog-Digital Converter FDD</b></div>
<div><br/></div>
<div><b><br/></b></div>
<div><b>2.</b>  The motor drivers used for the system would be pairs of 1/2 H-bridges.  It was not hard to decide on which device to use for these components.  They simply needed to operate on standard logic-level voltage, and be able to supply at least 7V to the motors.  For power requirements, the chip (if it is a dual H-bridge controlling 2 motors) would need to be able to supply a max. of .720A, the current two of our chosen motors would pull at their stall torque.  Most motor drivers could easily supply this.</div>
<div><br/></div>
<div>     The TI <span style="font-family: ArialMT; font-size: 10pt;"><b>DRV8835</b> (Fig. 2)<b> </b></span><font face="ArialMT"><span style="font-size: 10pt;">is a dual H-bridge chip that can supply 1.5A per H-bridge (more than we</span><span style="font-size: 13px;">’</span><span style="font-size: 10pt;">ll need) at 0-11V and can operate from 2-7V.  It requires very few peripheral components which will be good, since we need 4 drivers to </span><span style="font-size: 13px;">accommodate</span><span style="font-size: 10pt;"> the 7 motors (components with more peripheral support components were avoided to try to keep circuit size down as much as possible).</span></font></div>
<div><span style="font-size: 10pt;"><span style="font-family: ArialMT;"><br/></span></span></div>
<div><img src="27_Parts%20Decisions.resources/Screen%20Shot%202015-11-01%20at%208.28.48%20PM.png" height="1133" width="976"/></div>
<div><b>Figure 2:  <span style="font-family: ArialMT; font-size: 10pt;">DRV8835 Motor Driver FDD</span></b></div>
<div><b><span style="font-size: 10pt;"><span style="font-family: ArialMT;"><br/></span></span></b></div>
<div><b><span style="font-size: 10pt;"><span style="font-family: ArialMT;"><br/></span></span></b></div>
<div><b style="font-family: ArialMT; font-size: 10pt;">3.  </b><font face="ArialMT"><span style="font-size: 10pt;">The voltage regulators needed for the device are (a) a 7V step-down for motor power, (b) a 3.3-5V step-down for logic-level power, and possibly (c) a -3.3 to -5V for the EMG system</span><span style="font-size: 13px;">’</span><span style="font-size: 10pt;">s analog components (instead of using +- 3.3 / 5V, we may use GND and +5V as analog references).</span></font></div>
<div><span style="font-size: 10pt;"><span style="font-family: ArialMT;"><br/></span></span></div>
<div><font face="ArialMT"><span style="font-size: 10pt;">     The decided battery supply for the device (discussed more later) is 11.1V @ 4-5Ah.  Because there is a fairly large drop in voltage from 11.1 to 7V and 5V for the device</span><span style="font-size: 13px;">’</span><span style="font-size: 10pt;">s systems, we wanted to use switching regulators where possible.  Linear regulators will waste P=V<span style="font-size: 10px;">drop</span>*I<span style="font-size: 10px;">load</span> , so it would not be a good idea to use them to power the 7V motor line since motors can be expected to pull the most power in the device.  Switching regulators save more power, but can introduce noise into the system; so linear regulators will be used to power the EMG devices (they will not draw much current, so wasted power will not be much).</span></font></div>
<div><span style="font-size: 10pt;"><span style="font-family: ArialMT;"><br/></span></span></div>
<div><font face="ArialMT"><span style="font-size: 10pt;">     For the 7V motor power line, the Analog Devices Inc.</span></font><a style="color: rgb(0, 0, 0); font-family: Arial; font-size: 12px;" href="http://www.analog.com/media/en/technical-documentation/data-sheets/ADP2302_2303.pdf"> </a><span style="color: rgb(0, 0, 0); font-family: Arial; font-size: 12px;"><b>ADP2303ARDZ-R7</b> (Fig. 3)</span><font face="Arial" size="2"> was found to meed the device’s needs.  The regulator accepts and operates efficiently at the battery supply level of 11.1V and can supply up to 3A out.  The 7 motors will never draw more than .360A each, making a max. of 2.5A power draw from the motors.</font></div>
<div><span style="font-size: 12px;"><span style="font-family: Arial;"><br/></span></span></div>
<div><img src="27_Parts%20Decisions.resources/Screen%20Shot%202015-11-01%20at%208.49.34%20PM.png" height="372" width="802"/></div>
<div><b>Figure 3:  Sample Application Circuit for </b><span style="color: rgb(0, 0, 0); font-family: Arial; font-size: 12px;"><b>ADP2303ARDZ-R7</b></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Arial;"><br/></span></span></div>
<div>     <span style="font-size: 12px;"><span style="font-family: Arial;">For a 5V and 3.3V power line, linear regulators will be used (if it turns out that the microprocessor draws significant power, then it may be put on a 3.3V switching reg. line).  For the linear regulators, the Analog Devices Inc. </span></span></div>
<div>
<div style="box-sizing: border-box; padding: 0px; orphans: auto; text-align: start; text-indent: 0px; widows: auto;">
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-size: 12px;"><b>ADP7112ACBZ-5.0-R7</b> (Fig. 4) and <b>ADP7112ACBZ-3.3-R7</b> (Fig. 5) were chosen.  These regulators provide fixed outputs of 5V and 3V respectively; fixed output regulators were chosen to reduce peripheral parts.  Each regulator can take in up to 20V and supply a load current max. of 200mA.</span></span></div>
</div>
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><span style="font-size: 12px;"><span style="font-family: Arial, Helvetica, sans-serif;"><br/></span></span></div>
</div>
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><span style="font-size: 12px;"><span style="font-family: Arial, Helvetica, sans-serif;">    </span></span><img src="27_Parts%20Decisions.resources/Screen%20Shot%202015-11-02%20at%208.28.52%20PM.png" height="306" width="540"/></div>
</div>
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><b>Figure 4: Sample Application Circuit for </b><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-size: 12px;"><b>ADP7112ACBZ-5.0-R7</b></span></span></div>
</div>
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><b><span style="font-size: 12px;"><span style="font-family: Arial, Helvetica, sans-serif;"><br/></span></span></b></div>
</div>
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><img src="27_Parts%20Decisions.resources/Screen%20Shot%202015-11-02%20at%208.28.52%20PM_1.png" height="306" width="540"/></div>
</div>
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><b>Figure 5: Sample Application Circuit for </b><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-size: 12px;"><b>ADP7112ACBZ-3.3-R7</b></span></span></div>
</div>
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><b><span style="font-size: 12px;"><span style="font-family: Arial, Helvetica, sans-serif;"><br/></span></span></b></div>
</div>
<div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><b><span style="font-size: 12px;"><span style="font-family: Arial, Helvetica, sans-serif;"><br/></span></span></b></div>
</div>
<div><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 12px;"><span style="font-family: Arial, Helvetica, sans-serif;"><b>4.  </b>Which </span></span><font face="Arial, Helvetica, sans-serif" size="2">micro-controller(s) to use for the project has been largely dependent on flash storage size, PWM outputs, and Analog Inputs.  For the motor feedback system, at least 7 ADC channels are needed to monitor motor current draw.  Also 7 PWM’s are needed to control motor speed (and 7 GPIO for direction).  These in addition to at least 10 other GPIO pins as well as SPI and I2C communication were the primary requirements for the MCU.  </font></div>
<div><font face="Arial, Helvetica, sans-serif" size="2">     We narrowed our choices down to a Freescale <b>MC9S12DP512DGV1</b> and a <b>dsPIC33EP512GM330 (Fig. 6)</b>.  Both had enough PWM’s, analog inputs, and GPIO’s.  The dsPIC33 has a faster clock speed maximum at 70MHz as opposed to the 16MHz S12 clock.  The dsPIC also had more inputs for each of the needed inputs (PWM, analog, GPIO) than the S12.  The advantage of the S12 is that we had experience using it and development boards were on hand at the school, so we could start working with it immediately.  However, expecting our device program size to exceed 64kB, we were concerned about the limitations of free C compilers for the S12 (program size was normally limited to 64kB).  With the dsPIC33, we found free C compiler’s that only limited program size to 80% of the MCU total storage.  With a 512kB dsPIC33, we would have plenty of programming space.  The </font><font face="Arial, Helvetica, sans-serif" size="2"><b>dsPIC33EP512GM330</b></font> <font face="Arial, Helvetica, sans-serif" size="2">was chosen to control as our MCU (DSP). </font></div>
<div><span style="font-size: 12px;"><span style="font-family: Arial, Helvetica, sans-serif;"><br/></span></span></div>
<div><img src="27_Parts%20Decisions.resources/Screen%20Shot%202015-11-02%20at%208.52.37%20PM.png" height="1226" width="1224"/></div>
<div><b>Figure 6:  </b><font face="Arial, Helvetica, sans-serif" size="2"><b>dsPIC33EP512GM330 100-pin Pinout Diagram</b></font></div>
<div><b><span style="font-size: 12px;"><span style="font-family: Arial, Helvetica, sans-serif;"><br/></span></span></b></div>
<div><b style="font-family: Arial; font-size: 12px;">5.</b><font face="Arial" size="2">  For batteries, we decided to buy a prepackaged battery pack containing 3 Li-ion cells in series.  For most Li-ion batteries, the discharge voltage is around 2.7V with the nominal voltage around 3.7V.  To ensure battery capacity stayed as it it rated, we did not want to have to charge the battery pack before it reached it’s discharged state (battery capacity is measured from fully charged to discharge voltage; if we are only able to use the batteries for some voltage level above the discharge voltage, then our capacity will be less).  Because the motors will be running at 6V PWM, the discharge voltage of the battery pack needed to be no less than 7V to account for at most 1V dropout from the switching regulator.  Two series Li-ions would become discharged at 5.4V while a 3S Li-ion battery will discharge at 8.1V.</font></div>
<div><span style="font-size: 12px;"><span style="font-family: Arial;">     Considering that the motors will draw an average of 50-60mA when being used, the total power draw for the motors alone would be (7x60mA = 420mA) if they were running constantly.  To be able to run for 14 hrs, the battery capacity would need to be 14hr*.420A = 5.88Ah.  We only expect normal usage of the device to require the primary motors to run for about 15min. for every hour, cutting the power requirements by a significant amount.  For prototyping purposes, 5Ah was used as a general estimate for a max. power requirement of the system.</span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Arial;">     When looking at battery packs, most Li-ion 3S packs had a capacity of about (11.1V, 2.2Ah).  Batteries with higher capacity were available, but were usually more than twice as expensive for about 1.5x capacity.  It was decided to use several  <b>Tenergy 11.1V 2200mAh</b> battery packs for portable power supply.  At least two packs would be used in parallel, making 4.4Ah.  If more power is needed, a third pack could be used.  (A 3S2P pack was not chosen, because the packs are normally bulkier and would not satisfy our device size requirements; with thinner 3S packs, we can lay them out in a plane rather than stacking them together).  The Tenergy battery pack comes with a built in PCB that protects the pack from overcharge and discharge; Tenergy also provides AC-to-DC chargers that are built specifically for their battery packs.<br/></span></span></div>
</div>
</div>
</body></html>